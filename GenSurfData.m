set(0,'defaultaxesFontSize',17)
set(0,'defaultAxesFontName', 'times')
set(0,'defaultTextFontName', 'times')
co = brewermap(4,'PrGn');
set(groot,'defaultAxesColorOrder',co)
%% create surface temp relaxation conditions
cd ~/Documents/Work/Thesis/MITgcm/windtesting/input/
clear all

fmt='real*8';
accuracy='real*8';
Ieee='b';

resolution = 10;
nx = 4000/resolution;
ny = 2000/resolution;

nytot = ny + 40/resolution;
difference = 40/resolution/2;

deltaT0 = 1.5;
deltaT = 8-deltaT0;


surfT = zeros(nx,nytot);

for i = 1:nx
    surfT(i,:) = [deltaT/(nytot-1)*(0:nytot-1)+deltaT0];
end

fid=fopen('surfacetemp65.bin','w','b'); fwrite(fid,surfT,'real*8'); fclose(fid);
% 
 for i = 1:nx
     surfT(i,:) = [7/(nytot-1)*(0:nytot-1)+1];
end
% 
 fid=fopen('surfacetemp7.bin','w','b'); fwrite(fid,surfT,'real*8'); fclose(fid);

for i = 1:nx
    surfT(i,:) = [8/(nytot-1)*(0:nytot-1)];
end
fid=fopen('surfacetemp8.bin','w','b'); fwrite(fid,surfT,'real*8'); fclose(fid);

 heatflux = zeros(nx,nytot);
 for i = 1:nx
     %surfQ(i,:) = 10*sin(2*pi*(1:nytot)/nytot);
     surfQ(i,:) = 10*cos(3/2*pi*(1:nytot)/nytot);
 end
 
fid=fopen('2xQfile.bin','w','b'); fwrite(fid,surfQ,'real*8'); fclose(fid);
surfQ(:,1:2) = 0;

% fid = fopen('sponge_temp.bin','r','b'); 
% spongetemp = fread(fid,'real*8'); fclose(fid);
% spongetemp = reshape(spongetemp,600,204,32);
% 
% fid=fopen('sponge_temp8.bin','w','b');
% fwrite(fid,spongetemp./2.5,'real*8'); fclose(fid);
% 
% fid = fopen('hydrogThetaFile.bin','r','b');
% temp = fread(fid,'real*8'); fclose(fid);
% %temp = reshape(temp,600,204,32);
% 
% fid = fopen('hydrogThetaFile8.bin','w','b');
% fwrite(fid,temp./2.5,'real*8'); fclose(fid);
% 
% fid = fopen('zonalWindFile.bin','r','b');
% wind = fread(fid,'real*8'); fclose(fid);
% 
% fid = fopen('zonalWindFile2.bin','w','b');
% fwrite(fid,wind*2,'real*8'); fclose(fid);
% %temp = reshape(temp,600,204,32);
% 
% fid = fopen('zonalWindFile2.bin','w','b');
% fwrite(fid,wind.*2,'real*8'); fclose(fid);
%%
grid = [10, 10, 10, 12, 14, 18, 23, 27, 31, 38, 45, 53, 60, 68, 76, 86, 96, 102, 124, 135, 152, 180, 200, 220, 250, 280, 280, 280, 280, 280, 280, 280];
depthbottom = -cumsum(grid);
zc = depthbottom + grid/2;

zmixed = 40;
kappa=1e-5;
kappavm=1e-2;

kappav=(1+tanh((zc+zmixed)/5))/2*(kappavm-kappa)+kappa;

%% create layers for layers package

layers = 0:8/149:8;



%% create northern sponge temp
spongetemp = zeros(nx,nytot,32);
zc1 = -4000:(4000/50):0;

for z = 1:length(zc)
    spongetemp(:,:,z) = 8*(exp(zc(z)/1000) - exp(-4000/1000))/(1-exp(-4000/1000));
end

for z = 1:length(zc1)
    tempout(z) = 8.3*(exp(zc1(z)/1000) - exp(-4000/1000))/(1-exp(-4000/1000));
end


spongetemp(spongetemp < 0) = 0;
% fid = fopen('sponge_temp.bin','r','b'); 
% spongetemp = fread(fid,'real*8'); fclose(fid);
% %spongetemp = reshape(spongetemp,600,204,32);

 fid=fopen('sponge_temp8.bin','w','b');
 fwrite(fid,spongetemp,'real*8'); fclose(fid);
 
 %% create northern dic sponge
 
 dicsponge = -7.9e-6*spongetemp + 0.0022;
 
 fid=fopen('sponge_dic.bin','w','b');
 fwrite(fid,dicsponge,'real*8'); fclose(fid);
 
%% create Glodap dic sponge

depthtop = [0, grid];
oldTCO2 =  ncread('~/Documents/Work/Thesis/Data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.TCO2.nc','TCO2');
oldTCO2 = squeeze(nanmean(oldTCO2,1));
TCO2 = ncread('~/Documents/Work/Thesis/Data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.PI_TCO2.nc','PI_TCO2');
TCO2 = squeeze(nanmean(TCO2,1));
Depth = ncread('~/Documents/Work/Thesis/Data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.TCO2.nc','Depth');
lat = ncread('~/Documents/Work/Thesis/Data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.TCO2.nc','lat');
PO4 = ncread('~/Documents/Work/Thesis/Data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.PO4.nc','PO4');
PO4 = squeeze(nanmean(PO4,1));
TAlk = ncread('~/Documents/Work/Thesis/Data/GLODAPv2.2016b_MappedClimatologies/GLODAPv2.2016b.TAlk.nc','TAlk');
TAlk = squeeze(nanmean(TAlk,1));

figure;
contourf(lat(1:45),Depth,TCO2(1:45,:)')
axis ij

figure;
contourf(lat(1:45),Depth,oldTCO2(1:45,:)')
axis ij


% pick latitude for Southern Ocean, say 45 S

DICprofile = interp1(Depth,TCO2(45,:),-zc)*1e-3;
PO4profile = interp1(Depth,PO4(45,:),-zc)*1e-3;
Alkprofile = interp1(Depth,TAlk(45,:),-zc)*1e-3;

for i = 1:nx
    for j = 1:nytot
        glodapsponge(i,j,:) = DICprofile;
    end
end

fid=fopen('GLODAPsponge_dic.bin','w','b');
fwrite(fid,glodapsponge,'real*8'); fclose(fid);


for i = 1:nx
    for j = 1:nytot
        glodapPO4sponge(i,j,:) = PO4profile;
    end
end

fid=fopen('GLODAPsponge_po4.bin','w','b');
fwrite(fid,glodapPO4sponge,'real*8'); fclose(fid);

for i = 1:nx
    for j = 1:nytot
        glodapAlksponge(i,j,:) = Alkprofile;
    end
end

fid=fopen('GLODAPsponge_Alk.bin','w','b');
fwrite(fid,glodapAlksponge,'real*8'); fclose(fid);


 %% create rbcs mask

mask = zeros(nx,nytot,length(zc));
maskvec = 1:-1/9:0;
for i = 1:10
    mask(:,nytot-difference+2-i,:) = maskvec(i);
end
 fid=fopen('rbcs_mask_T.bin','w','b');
 fwrite(fid,mask,'real*8'); fclose(fid);
 
 mask(:,:,1) = 0;
fid=fopen('rbcs_mask_DIC.bin','w','b');
fwrite(fid,mask,'real*8'); fclose(fid);
 
 %% create tracer initial file and temp file
 tempgrid = [3.16886651141370,3.05406484533557,2.91846263908993,2.79197035104906,2.65620074650106,2.56699875372358,2.46962111532703,2.38631452039704,2.22806095547122,2.15538874479944,2.05736360398274,1.89075762522954,1.82896569767069,1.70566984872547,1.49955458247410,1.43465907720040,1.28392024459700,1.09029406466111,0.990272011130009,0.837328615672604,0.740415376318227,0.582195472433593,0.528378078748464,0.366948543566974,0.355218001070857,0.236854872639928,0.194276747476977,0.136515984064281,0.115209921557932,0.102523767302963,0.0438184401343300,0.0521850692792923;3.29762667723235,3.12691670587583,2.97976387898809,2.85002426567408,2.75394673232933,2.66622475355698,2.54730983495917,2.45928116134158,2.33449871241598,2.21577293745764,2.08595651584147,1.95625913982095,1.87008834514080,1.75566467863076,1.61674487714257,1.45160774942444,1.30629720557955,1.10879104955619,1.02249636424872,0.894617644498875,0.741404481669189,0.615816311312591,0.517437273075369,0.441509399907600,0.308623457236896,0.298149945619732,0.199392412283157,0.121972890228657,0.0727145001868344,0.0686894884663578,0.00319200371390680,-0.000347825533228444;3.34836355499041,3.21413293297710,3.11589675988802,2.98758644023377,2.85232142154518,2.71417248828245,2.65534836872656,2.49272397729710,2.35079421914449,2.30919429458259,2.14990933511042,2.00816674564017,1.94102800005637,1.74219815090567,1.65912937262800,1.50759808313526,1.33762903248333,1.18772649001467,1.02059891675695,0.850623072904942,0.745013032464778,0.598296893610657,0.513692089655759,0.429017691234407,0.351719980313443,0.280920056960720,0.195421177568162,0.131128532460168,0.119757380382418,0.0577413367080809,0.0555976245474324,-0.00119549106298387;3.50921843922048,3.39516059529777,3.20321647580841,3.09632761830271,2.95212733714554,2.84576471814877,2.71031732310797,2.59602127379408,2.49085597404930,2.32207505572348,2.22711288005726,2.09901350574917,1.93319985470364,1.82553177426971,1.68649673915304,1.49356155544180,1.35921957420705,1.22877507669747,1.06693098741016,0.890521717813558,0.728307534363406,0.669923586192742,0.538280485707696,0.404796195732976,0.339625457273178,0.234701509109490,0.243546571396656,0.196958596627745,0.128343238021899,0.0813467090540024,0.0663550848352452,0.000918289156405922;3.65834779911196,3.49736514265723,3.31055155159193,3.17077397780747,3.08226671277228,2.91523958798295,2.81840813017871,2.70150921236664,2.55311099466127,2.42448830204987,2.31724437352922,2.14143023263977,2.00368470319740,1.84602044261924,1.74873324766470,1.59305872213231,1.39285607675799,1.21835745701117,1.10870026968848,0.903576895168198,0.776126547934650,0.630795264703259,0.501392838200894,0.422461974466808,0.315631418867262,0.312211393678786,0.177535551068723,0.127545507687972,0.148036447037263,0.0985231419132172,0.0699996460439682,0.0180611935655776;3.79936351557304,3.57683902218194,3.42727322326202,3.28469009711420,3.15126304713404,2.99332625940815,2.89124124877572,2.72650712755362,2.61065425651564,2.48927492339005,2.40162697864035,2.25915724402456,2.11602868256268,1.97005437282267,1.80595582134004,1.62193733667952,1.41660130433382,1.29039200827663,1.12364531137360,0.964199196220170,0.779502181118807,0.648081315398481,0.574725218907906,0.464655204734437,0.332971303077968,0.289900646261197,0.244701225964329,0.172844604284100,0.103275432724551,0.0671894763745951,0.0776510032223783,-0.0151251552113229;3.86960779428287,3.69118120799521,3.55142867664550,3.38269997451173,3.25054870944667,3.13796151125936,3.00884810797200,2.82100454538754,2.73400663315615,2.53761051493698,2.40959079499828,2.30187475809977,2.17121409994948,1.95419087897135,1.78449351020051,1.63232492912983,1.48902877610065,1.33098324171771,1.12436739370020,0.964307428683328,0.775991207872586,0.638578896928687,0.588255434110729,0.433572128313838,0.396715442978367,0.313966550644848,0.192752931637635,0.196614873007274,0.152219937737999,0.0522443360252755,0.0819010086043406,0.0282262313801833;4.04448243320093,3.86404256009313,3.73234615145605,3.51482878009908,3.40459835848560,3.26762096675561,3.11732296975834,2.95717836262391,2.76365924392443,2.67093228749338,2.54097322906901,2.34365297142827,2.22012616603847,2.03715198071359,1.88760157105348,1.67322087880970,1.49451595041138,1.34155500321450,1.12367857224279,0.963255409740853,0.801293534939701,0.732008954331847,0.575620517230940,0.428858570723988,0.390021473664722,0.269789135393582,0.198214102550258,0.159595243079221,0.110939320978473,0.0760388067574380,0.0180862950681379,-0.0175343808966790;4.20023258101374,4.03040984178665,3.85909473477165,3.64008501873031,3.49933957207064,3.34094985278036,3.21481534216238,3.00077049398598,2.89417830812948,2.77852010017914,2.60871685709459,2.43034235656537,2.24375942078833,2.09268656210598,1.90266330799701,1.76124996996014,1.53882686776826,1.33804243260426,1.22140362748082,0.998522143247477,0.859623916737027,0.704738860209682,0.612238662064328,0.496355904495904,0.346836673633642,0.319550349676605,0.235146278796056,0.140866630877761,0.126697608431310,0.111115957054184,0.0586418393328009,-0.0111665082325850;4.32288663868973,4.17279985996444,4.00100616364828,3.83324725673963,3.60730973106336,3.49985612127159,3.26696541075010,3.12986986407073,2.96981564338585,2.81810845769995,2.66870962532180,2.52941567369246,2.32687419982885,2.17255975084622,1.99941273391441,1.82546198194014,1.58051919445433,1.40459789128091,1.18360562688184,1.04240809377654,0.884700228285328,0.702779024378002,0.603000992097159,0.447588697394369,0.414344575203026,0.277756880270315,0.262290890391334,0.189969644264713,0.0936775073549421,0.0975253804420194,0.0176630193618363,0.0291901459041837;4.47025571428110,4.27667486144937,4.11450322385606,3.92000966314715,3.74199789059095,3.56142142999766,3.44794098916637,3.28024570369984,3.11908267984022,2.89135372031205,2.76578367066725,2.60279053480282,2.43099944625585,2.26622176026228,2.06493348242337,1.81609615347008,1.64079432630109,1.47311559298133,1.20441525443474,1.07856967392710,0.868282291662753,0.706653849311703,0.619354509064120,0.484015384427351,0.395824192896666,0.268375115394926,0.229400120890520,0.204393533431634,0.0907594954741765,0.0449799318495744,0.0321380779661279,0.0512298825970164;4.71530382734929,4.50240395530164,4.29392471689004,4.05371188749791,3.87907543681695,3.72747438142434,3.49879898834167,3.35920659602813,3.21589584426657,3.00778684170926,2.82330797942139,2.70530935502149,2.50663978084490,2.34417459288197,2.13322485477587,1.94730671125865,1.68798041787937,1.46244876825401,1.30825592183152,1.11694247849328,0.896421980649140,0.799293289751181,0.592675073939610,0.515983044828565,0.388198529437356,0.330788556882367,0.239532648213010,0.219208837778596,0.0997190699172124,0.0723761403648613,0.0151753945770755,-0.0116491768383199;4.80778113638930,4.59172707587102,4.42259649755542,4.24748414418040,4.06587641400795,3.86064403366885,3.69412878499186,3.48835913071617,3.27410947318829,3.11675452531453,2.92650593369205,2.76603152225044,2.56733227088875,2.40091838256002,2.18862344490882,1.99805074789802,1.75861478969584,1.52534922935399,1.34075798332053,1.14142140910651,0.950158680801823,0.745624969678311,0.651109102431933,0.518126727964693,0.429823816610678,0.279768920002669,0.234896660430741,0.153985080235491,0.162056577913321,0.102645333428715,0.0507422220907145,0.0532422823612155;5.03491199780264,4.80663445836468,4.58088128232820,4.40194915566288,4.15013100122288,4.00121801136501,3.82011128415306,3.57895382473909,3.41162572784053,3.26034859720403,3.04266384401438,2.88593178013522,2.64533371418930,2.49793999021033,2.22336138758254,2.06338188666294,1.82436602178660,1.54473497261324,1.36871997331382,1.16390047118824,0.926663936275391,0.829329504580934,0.606721755493089,0.541974654892897,0.444303932325086,0.364248737553105,0.222075977424401,0.164496440281158,0.132704194742606,0.0463537071484803,0.0692956914352980,-0.0185379811163922;5.23515900671900,4.96420346226565,4.79588979251040,4.55840359219448,4.33067323709187,4.16255720291911,3.91562335145966,3.74541681474512,3.54170321326925,3.35626061845725,3.13064659320363,2.97598526132380,2.74226369499652,2.51419372601520,2.31712321365682,2.08995089690974,1.81630499131549,1.57816123076370,1.37195174790165,1.17611897393983,0.943257542893084,0.840346998205474,0.675270708404564,0.517152965599460,0.410809536871677,0.296056584501150,0.233415315974507,0.172559825968937,0.167081421361760,0.0738522670785904,0.0693510456209940,0.0370610346081320;5.47716683610415,5.19880210264336,4.93762760154182,4.74534230307625,4.52523422894249,4.32159837940152,4.07105876649501,3.83764899298401,3.69422245045893,3.46997132113834,3.25315296161246,3.10536156010742,2.82524928085146,2.64991378685393,2.35936428536542,2.15254778948650,1.92267725830566,1.66453029265487,1.45282947920320,1.18621269200565,1.03612123167767,0.789862751652218,0.658353278526255,0.547217994947523,0.457034564308948,0.362882031186073,0.264429671164664,0.174222456262723,0.109278405165071,0.0734000731714844,0.0706606203503043,0.0246801223067109;5.62646355279968,5.36055765932595,5.12213675284669,4.90727629034736,4.68329217372172,4.40666529638205,4.22942151277904,3.99134904026709,3.79279999929052,3.58541094987582,3.36486258444858,3.17085456252934,2.94507246092559,2.73109005530587,2.45246289790774,2.23594839644911,1.95517477280231,1.72118039016372,1.46975942187267,1.20522176902464,0.992341579769799,0.879258876439723,0.729067090193042,0.523598230845199,0.415666353594547,0.379853463423822,0.252115271745061,0.187759974482663,0.163578858057129,0.0722946397867147,0.0754560055846151,-0.0164637675709506;5.88630280244153,5.65187680063982,5.31784789825327,5.11223059540222,4.82548965088814,4.64548632315039,4.41227336611684,4.17470333062673,3.91685820268128,3.72958498902809,3.53017329083344,3.32386175308680,3.06666428391276,2.79429560790525,2.55522885853196,2.28215705046379,2.03966888175873,1.76993605183010,1.51461905385169,1.29933153251737,1.06442854816091,0.834435528555395,0.709154957401686,0.595294757819027,0.445064076039387,0.367266144364930,0.263301654128912,0.214719495053154,0.162220005842740,0.0849348982112794,0.0219850082644471,0.0243734983387221;6.09614320585015,5.80848793291625,5.53233796846912,5.29868237249379,5.02822660718693,4.81320402939296,4.52663933598105,4.31310323684418,4.05493437377968,3.84330707768514,3.65068522628835,3.41955351827663,3.13140740268224,2.87455111877541,2.66412486435400,2.36587962836802,2.08971574803985,1.82136275889876,1.58132524287257,1.26949746246313,1.11045227218566,0.859601119559243,0.736646386289801,0.610710024346730,0.463715669522272,0.392051489000599,0.268822097395082,0.180450262316188,0.167936276207076,0.0616370831993712,0.0479228155423264,0.0157435762184975;6.40207032272839,6.07798990979263,5.76079693679333,5.50990886506990,5.27199331057687,4.97225022341984,4.70700570613534,4.46238551745052,4.26122229418731,3.99110199902081,3.75480555994395,3.53879693367930,3.26581991077499,3.01016376718671,2.69313158734623,2.44115528082047,2.13429328509147,1.84433735631309,1.57050986470525,1.34883277284522,1.09070261374858,0.905227368927688,0.777674360261028,0.580204682957165,0.444762324068023,0.394169056273920,0.263569863647109,0.231578332248155,0.159960504461681,0.124606532787959,0.0226763034098768,0.0173827880285540;6.62353136429467,6.28520514169199,5.97823760998476,5.66721262423267,5.43682016712971,5.18400578833896,4.90794614519417,4.65536360673806,4.37574907474158,4.12475333919899,3.86502914631992,3.63970173279135,3.37210868971395,3.09960593147054,2.76890797295721,2.53693163807932,2.22051611273827,1.93233984548092,1.65399074224110,1.35220988626469,1.12735888967581,0.950435806507812,0.746157370126367,0.618234472648010,0.460016782561888,0.343546201125303,0.288629608599144,0.183974913765427,0.171205646226250,0.0876750339252733,0.0220103868825882,0.0279485972767592;6.88389302614635,6.56512670766923,6.28281256664409,5.94231431503763,5.64408816384742,5.33475138083453,5.06611634016605,4.81922085043213,4.53394937336581,4.30064156892763,4.07177158780609,3.77495121792425,3.52159892738541,3.18456299519766,2.92051356986753,2.59068103781364,2.27335891702509,1.98342734047750,1.71813536825887,1.40563334798037,1.14030188738159,0.987784495553675,0.809099094844816,0.628565396487103,0.450952820286590,0.408125819767505,0.286886084592115,0.237573086724433,0.126323534396122,0.0561781896509826,0.0322950924991275,0.00950036886919669;7.20481635721248,6.86481180844206,6.50672040935083,6.20966843138700,5.85548144759974,5.55686724595205,5.30041756821962,4.99345184669611,4.69673170041692,4.41644566927636,4.19139988250563,3.88765498845372,3.61918282320172,3.30473375717071,3.01151989817870,2.65518886066517,2.36003072850530,2.06001540590364,1.72977693678379,1.45876279119385,1.16054541206436,0.975933570201114,0.790475475330949,0.657117626584547,0.504086053287086,0.361585846001916,0.277332784151587,0.216562585115084,0.136933373582539,0.113532893448162,0.0339561427008737,0.0458368364822709;7.49373056256914,7.17740105175375,6.80461182165692,6.46975847699757,6.08956563644953,5.84321127812305,5.52641143003552,5.20592476557044,4.95752528164713,4.65831218880615,4.33863380372183,4.04816612294134,3.77287715022240,3.41158237906805,3.14533805175607,2.75194789519250,2.42546329663911,2.09897309625256,1.79076579055666,1.50467635815288,1.26163500338092,1.02730704563877,0.793716486858913,0.636046952637420,0.508298441685857,0.405886125576799,0.303449336585654,0.200194785363333,0.180806679845021,0.0983277788494409,0.0810413325878736,0.0477541864555972];
zcold = [-25.1520004272461;-75.5305023193359;-126.094001770020;-176.932998657227;-228.181503295898;-280.036010742188;-332.785003662109;-386.847991943359;-442.826995849609;-501.569488525391;-564.236511230469;-632.356994628906;-707.831970214844;-792.838500976563;-889.583984375000;-999.919006347656;-1124.91894531250;-1264.58398437500;-1417.83898925781;-1582.83398437500;-1757.35900878906;-1939.23901367188;-2126.57397460938;-2317.83398437500;-2511.85888671875;-2707.79907226563;-2905.04907226563;-3103.19409179688;-3301.94897460938;-3501.11401367188;-3700.55395507813;-3900.17895507813];

[zgrid, ygrid] = meshgrid(zc,0:1/(nytot-1):1);
tempgridnew = interp2(zcold,0:1/23:1,tempgrid,zgrid,ygrid,'spline');
for i = 1:nx
    tempmat(i,:,:) = tempgridnew + rand(size(tempgridnew))-0.5;
end

  fid = fopen('hydrogThetaFile8Noise.bin','w','b');
 fwrite(fid,tempmat,'real*8'); fclose(fid);
 
 dicinit = -7.9e-6*tempmat + 0.0022;
   fid=fopen('init_dic.bin','w','b');
  fwrite(fid,dicinit,'real*8'); fclose(fid);
  
%% initial alk file

alkfile = tempmat*0+2.350;
fid=fopen('init_alk.bin','w','b');
fwrite(fid,alkfile,'real*8'); fclose(fid);

fid=fopen('init_dop.bin','w','b');
fwrite(fid,tempmat*0,'real*8'); fclose(fid);

%% create red and blue initial files
% mask = zeros(nx,nytot,length(zc));
% 
% mask(:,nytot-difference,:) = 1;
% 
% fid=fopen('rbcs_mask_Color.bin','w','b');
% fwrite(fid,mask,'real*8'); fclose(fid);
% 
% red = double(spongetemp > 1.6);
% blue = double(spongetemp < 1.6);
% 
% 
% fid=fopen('Red.bin','w','b');
% fwrite(fid,red,'real*8'); fclose(fid);
% 
% fid=fopen('Blue.bin','w','b');
% fwrite(fid,blue,'real*8'); fclose(fid);
% 
% redind = sum(spongetemp(1,1,:) > 2);
% red2 = double(spongetemp > 2);
% step = 0.05;
% for i = 1:(1/step-1)
%     red2(:,:,redind-i+1) = i*step;
% end
% 
% blue = double(spongetemp < 2);
% blue(:,:,redind+1) = 0.25;
% blue(:,:,redind+2) = 0.5;
% blue(:,:,redind+3) = 0.75;
% 
% 
% 
% 
% fid=fopen('Red2.bin','w','b');
% fwrite(fid,red2,'real*8'); fclose(fid);
% 
% fid=fopen('Blue2.bin','w','b');
% fwrite(fid,blue,'real*8'); fclose(fid);
% 
% red = double(spongetemp > 3.3);
% blue = double(spongetemp < 3.3);
% 
% 
% fid=fopen('Red3.bin','w','b');
% fwrite(fid,red,'real*8'); fclose(fid);
% 
% fid=fopen('Blue3.bin','w','b');
% fwrite(fid,blue,'real*8'); fclose(fid);
% 



 
%% compute wind files
for i = 1:nx
    wind(i,:) = [sin((0:nytot-1)*pi/(nytot-1))*0.1];
    meanwind(i,:) = 0.1*2/pi;
    %winddecay(i,:) = [sin((0:nytot-1)*pi/(nytot-1))*0.1].*(tanh((0.75-ygrid(:,1)')/.05)+1)/2;
end


fid = fopen('zonalWindFile.bin','w','b');
fwrite(fid,wind,'real*8'); fclose(fid);

% fid = fopen('zonalWindFileDecay.bin','w','b');
% fwrite(fid,winddecay,'real*8'); fclose(fid);

fid = fopen('zonalWindFile15.bin','w','b');
fwrite(fid,wind*1.5,'real*8'); fclose(fid);

fid = fopen('GasFluxWind15.bin','w','b');
fwrite(fid,meanwind*1.5,'real*8'); fclose(fid);


fid = fopen('zonalWindFile2.bin','w','b');
fwrite(fid,wind*2,'real*8'); fclose(fid);

fid = fopen('zonalWindFile25.bin','w','b');
fwrite(fid,wind*2.5,'real*8'); fclose(fid);

fid = fopen('zonalWindFile05.bin','w','b');
fwrite(fid,wind*0.5,'real*8'); fclose(fid);

fid = fopen('zonalWindFile025.bin','w','b');
fwrite(fid,wind*0.25,'real*8'); fclose(fid);

fid = fopen('zonalWindFile4.bin','w','b');
fwrite(fid,wind*4,'real*8'); fclose(fid);


 %% create flat topography
 bathy250 = zeros(nx,nytot);
 bathy500 = zeros(nx,nytot);
 bathy1000 = zeros(nx,nytot);
 bathyflat = zeros(nx,nytot);
  bathy2000 = zeros(nx,nytot);




for i = 1:nx
    bathy100(i,3:nytot-2) = -4000+ 100*exp(-(i-nx/6)^2/(200/resolution)^2);
    bathy200(i,3:nytot-2) = -4000+ 200*exp(-(i-nx/6)^2/(200/resolution)^2);
    bathy250(i,3:nytot-2) = -4000+ 250*exp(-(i-nx/6)^2/(200/resolution)^2);
    bathy500(i,3:nytot-2) = -4000+ 500*exp(-(i-nx/6)^2/(200/resolution)^2);
    bathy1000(i,3:nytot-2) = -4000+ 1000*exp(-(i-nx/6)^2/(200/resolution)^2);
    bathy2000(i,3:nytot-2) = -4000+ 2000*exp(-(i-nx/6)^2/(200/resolution)^2);
    bathyflat(i,3:nytot-2) = -4000;
end





fid = fopen('bathyFileFlat.bin','w','b');
fwrite(fid,bathyflat,'real*8'); fclose(fid);

fid = fopen('bathyFile100.bin','w','b');
fwrite(fid,bathy100,'real*8'); fclose(fid);

fid = fopen('bathyFile200.bin','w','b');
fwrite(fid,bathy200,'real*8'); fclose(fid);


fid = fopen('bathyFile250.bin','w','b');
fwrite(fid,bathy250,'real*8'); fclose(fid);


fid = fopen('bathyFile500.bin','w','b');
fwrite(fid,bathy500,'real*8'); fclose(fid);

fid = fopen('bathyFile1000.bin','w','b');
fwrite(fid,bathy1000,'real*8'); fclose(fid);

fid = fopen('bathyFile2000.bin','w','b');
fwrite(fid,bathy2000,'real*8'); fclose(fid);


% cd ../../BIN_files/
%  %% examine old bin files
% 
% fid = fopen('thetaClimFile_lin.bin','r','b');  
% surftemp = fread(fid,'real*8'); fclose(fid);
% surftemp = reshape(surftemp,200,[]);
%  
% 
%  
 %% create relaxation temperatures for different topographies
 tsurfflat = [0,0,0,0.00809978000000000,0.130998090000000,0.247639880000000,0.341460350000000,0.392693600000000,0.419873900000000,0.434955060000000,0.446116180000000,0.456900300000000,0.468571700000000,0.482092560000000,0.498646770000000,0.518099200000000,0.540286400000000,0.564714200000000,0.591886200000000,0.621986600000000,0.654178900000000,0.687720360000000,0.722443940000000,0.757832170000000,0.793308560000000,0.828138700000000,0.862170640000000,0.895992500000000,0.930308200000000,0.965079070000000,1.00032000000000,1.03567300000000,1.07056990000000,1.10554090000000,1.14097960000000,1.17707370000000,1.21407940000000,1.25228270000000,1.29162380000000,1.33184860000000,1.37305650000000,1.41454800000000,1.45652130000000,1.49868790000000,1.54033570000000,1.58191740000000,1.62284860000000,1.66285700000000,1.70230700000000,1.74125730000000,1.77992190000000,1.81846630000000,1.85681570000000,1.89560530000000,1.93531560000000,1.97611690000000,2.01787350000000,2.06011220000000,2.10227560000000,2.14388600000000,2.18515320000000,2.22632340000000,2.26749230000000,2.30884800000000,2.35024570000000,2.39170200000000,2.43300080000000,2.47357730000000,2.51331350000000,2.55268070000000,2.59214160000000,2.63173060000000,2.67131230000000,2.71134700000000,2.75249580000000,2.79525880000000,2.83952330000000,2.88467340000000,2.93069530000000,2.97697100000000,3.02300200000000,3.06856870000000,3.11392880000000,3.15951470000000,3.20510080000000,3.25023370000000,3.29524520000000,3.34008600000000,3.38526700000000,3.43173960000000,3.47950120000000,3.52704760000000,3.57241460000000,3.61560250000000,3.65714670000000,3.69734980000000,3.73711800000000,3.77719900000000,3.81705600000000,3.85598680000000,3.89447260000000,3.93331340000000,3.97316050000000,4.01408000000000,4.05587100000000,4.09824560000000,4.14054500000000,4.18210300000000,4.22316000000000,4.26405800000000,4.30499200000000,4.34627960000000,4.38757100000000,4.42856450000000,4.46972660000000,4.51119140000000,4.55203440000000,4.59193900000000,4.63143900000000,4.67117800000000,4.71090030000000,4.75078870000000,4.79101370000000,4.83074600000000,4.86975700000000,4.90819500000000,4.94591430000000,4.98313470000000,5.02037100000000,5.05759900000000,5.09455250000000,5.13115800000000,5.16795400000000,5.20534400000000,5.24313830000000,5.28117100000000,5.31935550000000,5.35755970000000,5.39539200000000,5.43275450000000,5.47003800000000,5.50712160000000,5.54364900000000,5.58018100000000,5.61703250000000,5.65427000000000,5.69140900000000,5.72867770000000,5.76623150000000,5.80348000000000,5.84088700000000,5.87888700000000,5.91744700000000,5.95668600000000,5.99639030000000,6.03652800000000,6.07707360000000,6.11819300000000,6.15988350000000,6.20212030000000,6.24461200000000,6.28693200000000,6.32902800000000,6.37100840000000,6.41301200000000,6.45508000000000,6.49752600000000,6.54045770000000,6.58440300000000,6.62945700000000,6.67512270000000,6.72137600000000,6.76788330000000,6.81463240000000,6.86114260000000,6.90692850000000,6.95190300000000,6.99601700000000,7.03897520000000,7.08125730000000,7.12318000000000,7.16512200000000,7.20720800000000,7.24968200000000,7.29250430000000,7.33556840000000,7.37859440000000,7.42104240000000,7.46166850000000,7.49972100000000,7.53510760000000,7.56817400000000,7.59896600000000,7.62814900000000,7.66042600000000,7.69401300000000,7.72483630000000,7.75171380000000,7.77354150000000,7.79009400000000,7.80151600000000,7.80825230000000,7.81070100000000,0];
 tsurf250 = [0,0,0,0.717770400000000,0.916609700000000,1.06742190000000,1.16194860000000,1.21174420000000,1.24123230000000,1.26520900000000,1.28991020000000,1.31704890000000,1.34662400000000,1.37845180000000,1.41250030000000,1.44839200000000,1.48510150000000,1.52226020000000,1.56003670000000,1.59815850000000,1.63662340000000,1.67528900000000,1.71464360000000,1.75459300000000,1.79460300000000,1.83481980000000,1.87496440000000,1.91545920000000,1.95680370000000,1.99867700000000,2.04090260000000,2.08336700000000,2.12568550000000,2.16786670000000,2.21040600000000,2.25385300000000,2.29773710000000,2.34166030000000,2.38565180000000,2.42994570000000,2.47473380000000,2.51932100000000,2.56276800000000,2.60503360000000,2.64643000000000,2.68741270000000,2.72823400000000,2.76869680000000,2.80858200000000,2.84809280000000,2.88757000000000,2.92693000000000,2.96593710000000,3.00501600000000,3.04452280000000,3.08474920000000,3.12586670000000,3.16809560000000,3.21082280000000,3.25391300000000,3.29752450000000,3.34157130000000,3.38586780000000,3.43081780000000,3.47646240000000,3.52183940000000,3.56655300000000,3.61107700000000,3.65548520000000,3.69990920000000,3.74469420000000,3.78969290000000,3.83486870000000,3.88006540000000,3.92556950000000,3.97191360000000,4.01903500000000,4.06665800000000,4.11465640000000,4.16254470000000,4.21032430000000,4.25813600000000,4.30598900000000,4.35401600000000,4.40238300000000,4.45068740000000,4.49875000000000,4.54682100000000,4.59483600000000,4.64269100000000,4.69028470000000,4.73741440000000,4.78384700000000,4.82969500000000,4.87514200000000,4.92068240000000,4.96631340000000,5.01186200000000,5.05751600000000,5.10271640000000,5.14673040000000,5.18936500000000,5.23142400000000,5.27329250000000,5.31502800000000,5.35650800000000,5.39703300000000,5.43660260000000,5.47529500000000,5.51317700000000,5.55037360000000,5.58715800000000,5.62387560000000,5.66059060000000,5.69715830000000,5.73333840000000,5.76900770000000,5.80463360000000,5.84064000000000,5.87691200000000,5.91363000000000,5.95087900000000,5.98846300000000,6.02602900000000,6.06355900000000,6.10144040000000,6.13997100000000,6.17914870000000,6.21891600000000,6.25916000000000,6.29983430000000,6.34052660000000,6.38119130000000,6.42186980000000,6.46220300000000,6.50227830000000,6.54204650000000,6.58131840000000,6.62004500000000,6.65807630000000,6.69533500000000,6.73186730000000,6.76799000000000,6.80372050000000,6.83900450000000,6.87380840000000,6.90811250000000,6.94182100000000,6.97493740000000,7.00745530000000,7.03954170000000,7.07135150000000,7.10275400000000,7.13362100000000,7.16418270000000,7.19464600000000,7.22518830000000,7.25611000000000,7.28754200000000,7.31926440000000,7.35101270000000,7.38267300000000,7.41409250000000,7.44532350000000,7.47638270000000,7.50743500000000,7.53879200000000,7.57052040000000,7.60240130000000,7.63432900000000,7.66591600000000,7.69702630000000,7.72785800000000,7.75852730000000,7.78878600000000,7.81886430000000,7.84881200000000,7.87834360000000,7.90759660000000,7.93643300000000,7.96449330000000,7.99134730000000,8.01669200000000,8.04026200000000,8.06202300000000,8.08231200000000,8.10127500000000,8.11826700000000,8.13211200000000,8.14129600000000,8.14397400000000,8.13823200000000,8.12149900000000,8.09067100000000,8.04077100000000,7.98035050000000,7.92138340000000,7.87231350000000,7.83800650000000,7.81904800000000,7.81163170000000,7.81028130000000,7.81008670000000,0];
 tsurf500 = [0,0,0,1.13249370000000,1.35196840000000,1.50085540000000,1.59953080000000,1.65201490000000,1.68459480000000,1.70996280000000,1.73475310000000,1.76076160000000,1.78809120000000,1.81750950000000,1.84986210000000,1.88455860000000,1.92072380000000,1.95815840000000,1.99673040000000,2.03675960000000,2.07765150000000,2.11879730000000,2.16007110000000,2.20168690000000,2.24384600000000,2.28611280000000,2.32833670000000,2.37045760000000,2.41267500000000,2.45495560000000,2.49741650000000,2.54005360000000,2.58349420000000,2.62826060000000,2.67399790000000,2.72033790000000,2.76699160000000,2.81411860000000,2.86123540000000,2.90811970000000,2.95431350000000,2.99956460000000,3.04394250000000,3.08740230000000,3.13000150000000,3.17203380000000,3.21382280000000,3.25516990000000,3.29634700000000,3.33749530000000,3.37838340000000,3.41849600000000,3.45825670000000,3.49842640000000,3.53882460000000,3.57910590000000,3.61933660000000,3.65981480000000,3.70031600000000,3.74102500000000,3.78234820000000,3.82435500000000,3.86649080000000,3.90815880000000,3.94929030000000,3.99019030000000,4.03119130000000,4.07239960000000,4.11366460000000,4.15429930000000,4.19415240000000,4.23351670000000,4.27255060000000,4.31115960000000,4.34900000000000,4.38623480000000,4.42319150000000,4.46001630000000,4.49643560000000,4.53279920000000,4.56927630000000,4.60554550000000,4.64173700000000,4.67794560000000,4.71411750000000,4.74981640000000,4.78536560000000,4.82139500000000,4.85842560000000,4.89645960000000,4.93494460000000,4.97348640000000,5.01239100000000,5.05189900000000,5.09209900000000,5.13252900000000,5.17307420000000,5.21383800000000,5.25461340000000,5.29531800000000,5.33585740000000,5.37606860000000,5.41606760000000,5.45632300000000,5.49603180000000,5.53491350000000,5.57367300000000,5.61241600000000,5.65079260000000,5.68854000000000,5.72594800000000,5.76280640000000,5.79885960000000,5.83445600000000,5.87000200000000,5.90541700000000,5.94067100000000,5.97558300000000,6.01012100000000,6.04443740000000,6.07822470000000,6.11118750000000,6.14354000000000,6.17577800000000,6.20828630000000,6.24074360000000,6.27296700000000,6.30528500000000,6.33742240000000,6.36891700000000,6.39992570000000,6.43087670000000,6.46183540000000,6.49272160000000,6.52352500000000,6.55409800000000,6.58441600000000,6.61467900000000,6.64516000000000,6.67583100000000,6.70679570000000,6.73822160000000,6.77003150000000,6.80234530000000,6.83527500000000,6.86864140000000,6.90248780000000,6.93647100000000,6.96998550000000,7.00289700000000,7.03560970000000,7.06844600000000,7.10131300000000,7.13411860000000,7.16692970000000,7.19947600000000,7.23131700000000,7.26251130000000,7.29360150000000,7.32475760000000,7.35586170000000,7.38686750000000,7.41761830000000,7.44820900000000,7.47852700000000,7.50842100000000,7.53816900000000,7.56790900000000,7.59773800000000,7.62796100000000,7.65842200000000,7.68923500000000,7.72077470000000,7.75301900000000,7.78585050000000,7.81893000000000,7.85185300000000,7.88469030000000,7.91738840000000,7.94983860000000,7.98212900000000,8.01428700000000,8.04592500000000,8.07639400000000,8.10462800000000,8.12967100000000,8.15121300000000,8.16838550000000,8.17979400000000,8.18421500000000,8.18026100000000,8.16646200000000,8.14130300000000,8.10281500000000,8.04711300000000,7.98311330000000,7.92225300000000,7.87211040000000,7.83731030000000,7.81828980000000,7.81102600000000,7.81002860000000,7.81017450000000,0];
 %tsurf1000 = [0,0,0,1.15367630000000,1.39419560000000,1.54713750000000,1.64711500000000,1.69706620000000,1.72692360000000,1.75000240000000,1.77259470000000,1.79679000000000,1.82275920000000,1.85124150000000,1.88208470000000,1.91508910000000,1.95028390000000,1.98722260000000,2.02475500000000,2.06258060000000,2.10119060000000,2.14033400000000,2.18010160000000,2.22104620000000,2.26306100000000,2.30649330000000,2.35129860000000,2.39663840000000,2.44170120000000,2.48599700000000,2.52979420000000,2.57294870000000,2.61562160000000,2.65754370000000,2.69826170000000,2.73780060000000,2.77712400000000,2.81703950000000,2.85762570000000,2.89834070000000,2.93839700000000,2.97784380000000,3.01741050000000,3.05727480000000,3.09719970000000,3.13723970000000,3.17725200000000,3.21695300000000,3.25672800000000,3.29734040000000,3.33868150000000,3.38018060000000,3.42107730000000,3.46166160000000,3.50267000000000,3.54429050000000,3.58632420000000,3.62861280000000,3.67097400000000,3.71295050000000,3.75477740000000,3.79705480000000,3.83955400000000,3.88192460000000,3.92426970000000,3.96672750000000,4.00905660000000,4.05129500000000,4.09355930000000,4.13547130000000,4.17635350000000,4.21610500000000,4.25480650000000,4.29220200000000,4.32827500000000,4.36369470000000,4.39925430000000,4.43531940000000,4.47226860000000,4.50973900000000,4.54739240000000,4.58532200000000,4.62366900000000,4.66206400000000,4.70012760000000,4.73779250000000,4.77511100000000,4.81187400000000,4.84783300000000,4.88315200000000,4.91830600000000,4.95363000000000,4.98873100000000,5.02334800000000,5.05739550000000,5.09128900000000,5.12543400000000,5.15999200000000,5.19482660000000,5.22971900000000,5.26520060000000,5.30128500000000,5.33784400000000,5.37473340000000,5.41193300000000,5.44930550000000,5.48690600000000,5.52465340000000,5.56256250000000,5.60066900000000,5.63862700000000,5.67607830000000,5.71301030000000,5.74947100000000,5.78583340000000,5.82163200000000,5.85633700000000,5.89008800000000,5.92287830000000,5.95484450000000,5.98618940000000,6.01711560000000,6.04792200000000,6.07885200000000,6.10976700000000,6.14056440000000,6.17125400000000,6.20174800000000,6.23200500000000,6.26205250000000,6.29203700000000,6.32223650000000,6.35259680000000,6.38283300000000,6.41303400000000,6.44364300000000,6.47491400000000,6.50651550000000,6.53826950000000,6.56994870000000,6.60133800000000,6.63272430000000,6.66435050000000,6.69608100000000,6.72799200000000,6.76028540000000,6.79300100000000,6.82566200000000,6.85803700000000,6.89053100000000,6.92359200000000,6.95740300000000,6.99142930000000,7.02536630000000,7.05919800000000,7.09275700000000,7.12603330000000,7.15866140000000,7.19057940000000,7.22191860000000,7.25282140000000,7.28357500000000,7.31428800000000,7.34524100000000,7.37638660000000,7.40724040000000,7.43812270000000,7.46922540000000,7.50060460000000,7.53230430000000,7.56436250000000,7.59698700000000,7.63026300000000,7.66400700000000,7.69858400000000,7.73367000000000,7.76887130000000,7.80431560000000,7.84037400000000,7.87698750000000,7.91387600000000,7.95095700000000,7.98766700000000,8.02313200000000,8.05636400000000,8.08629700000000,8.11171900000000,8.13122200000000,8.14388200000000,8.14908700000000,8.14644400000000,8.13508300000000,8.11377200000000,8.08033850000000,8.03110400000000,7.97394230000000,7.91896200000000,7.87258200000000,7.83847100000000,7.81830200000000,7.81007960000000,7.80904700000000,7.80976150000000,0];
 tsurf2000new = [0,0,1.50043770000000,1.55010250000000,1.58753050000000,1.61032940000000,1.62065700000000,1.62631920000000,1.63159820000000,1.63801190000000,1.64674990000000,1.65831410000000,1.67247650000000,1.68873370000000,1.70688460000000,1.72620440000000,1.74565840000000,1.76447030000000,1.78190450000000,1.79821540000000,1.81342280000000,1.82738640000000,1.84059380000000,1.85373130000000,1.86746810000000,1.88196100000000,1.89727000000000,1.91362230000000,1.93128400000000,1.95029780000000,1.97070690000000,1.99258950000000,2.01582840000000,2.04005340000000,2.06496670000000,2.09035330000000,2.11608700000000,2.14201350000000,2.16782800000000,2.19355420000000,2.21929980000000,2.24526290000000,2.27177830000000,2.29859920000000,2.32564450000000,2.35349900000000,2.38236140000000,2.41275400000000,2.44464970000000,2.47738580000000,2.51050350000000,2.54375550000000,2.57704260000000,2.61010980000000,2.64256640000000,2.67418070000000,2.70495650000000,2.73505740000000,2.76474100000000,2.79449820000000,2.82514380000000,2.85681800000000,2.88943080000000,2.92291330000000,2.95718360000000,2.99212480000000,3.02748680000000,3.06346130000000,3.09969660000000,3.13557200000000,3.17098520000000,3.20579580000000,3.24005900000000,3.27405670000000,3.30799200000000,3.34148200000000,3.37436440000000,3.40638600000000,3.43786760000000,3.46920590000000,3.50046830000000,3.53179340000000,3.56327060000000,3.59459660000000,3.62556120000000,3.65653130000000,3.68766760000000,3.71933200000000,3.75153260000000,3.78455110000000,3.81841160000000,3.85272810000000,3.88773500000000,3.92335600000000,3.95970940000000,3.99679370000000,4.03457360000000,4.07283600000000,4.11141300000000,4.15065700000000,4.19066700000000,4.23097200000000,4.27141140000000,4.31185300000000,4.35185900000000,4.39110140000000,4.42965130000000,4.46787800000000,4.50615450000000,4.54451900000000,4.58268600000000,4.62024200000000,4.65697500000000,4.69269750000000,4.72713850000000,4.76062500000000,4.79339840000000,4.82531400000000,4.85675860000000,4.88825040000000,4.91969400000000,4.95107840000000,4.98272470000000,5.01473950000000,5.04719100000000,5.08030130000000,5.11443700000000,5.14961620000000,5.18577340000000,5.22275450000000,5.26032640000000,5.29859260000000,5.33770750000000,5.37737700000000,5.41698070000000,5.45587970000000,5.49374960000000,5.53106400000000,5.56866300000000,5.60670300000000,5.64492800000000,5.68295340000000,5.72057720000000,5.75806200000000,5.79559950000000,5.83287570000000,5.86964500000000,5.90604000000000,5.94224260000000,5.97857050000000,6.01491550000000,6.05101200000000,6.08671470000000,6.12214800000000,6.15740400000000,6.19251350000000,6.22724400000000,6.26160670000000,6.29581170000000,6.33023500000000,6.36498260000000,6.40006100000000,6.43574050000000,6.47209070000000,6.50902100000000,6.54662600000000,6.58529330000000,6.62496950000000,6.66541240000000,6.70658540000000,6.74839700000000,6.79105100000000,6.83461480000000,6.87878270000000,6.92365170000000,6.96936900000000,7.01567840000000,7.06231400000000,7.10907300000000,7.15532700000000,7.20100740000000,7.24629740000000,7.29176600000000,7.33794500000000,7.38452000000000,7.42993550000000,7.47317650000000,7.51365760000000,7.55114650000000,7.58516740000000,7.61505600000000,7.64019700000000,7.66074370000000,7.67645700000000,7.68764260000000,7.69702050000000,7.70816230000000,7.72301960000000,7.74203500000000,7.76441500000000,7.78642850000000,7.80745400000000,7.80618000000000,0];
 tsurf2000x2 = [0,0,0.695666900000000,0.958704800000000,1.11103420000000,1.21398680000000,1.26675180000000,1.29749430000000,1.32057310000000,1.34526900000000,1.37477420000000,1.40914600000000,1.44686410000000,1.48612650000000,1.52554510000000,1.56495270000000,1.60403410000000,1.64231050000000,1.67997990000000,1.71787070000000,1.75645410000000,1.79583010000000,1.83618100000000,1.87745760000000,1.91899260000000,1.96089520000000,2.00281790000000,2.04447940000000,2.08611230000000,2.12786530000000,2.17019150000000,2.21343470000000,2.25745650000000,2.30180360000000,2.34608840000000,2.39048860000000,2.43496180000000,2.47916300000000,2.52279190000000,2.56610060000000,2.60939240000000,2.65281680000000,2.69656520000000,2.74071150000000,2.78510740000000,2.82968850000000,2.87444260000000,2.91934700000000,2.96439460000000,3.00968900000000,3.05544300000000,3.10151430000000,3.14765740000000,3.19386430000000,3.24003460000000,3.28606340000000,3.33201400000000,3.37786360000000,3.42380290000000,3.47022560000000,3.51729510000000,3.56476660000000,3.61214600000000,3.65895410000000,3.70519260000000,3.75104670000000,3.79630420000000,3.84089970000000,3.88511780000000,3.92945400000000,3.97360850000000,4.01721200000000,4.06048500000000,4.10355000000000,4.14646100000000,4.18946550000000,4.23267600000000,4.27610640000000,4.31982230000000,4.36379530000000,4.40786030000000,4.45172170000000,4.49547340000000,4.53930200000000,4.58327250000000,4.62748800000000,4.67174200000000,4.71578030000000,4.75971700000000,4.80360560000000,4.84730240000000,4.89077400000000,4.93437700000000,4.97834970000000,5.02240100000000,5.06632000000000,5.11041740000000,5.15459060000000,5.19842400000000,5.24175020000000,5.28440430000000,5.32636100000000,5.36780000000000,5.40887600000000,5.44985060000000,5.49103000000000,5.53254370000000,5.57431130000000,5.61633600000000,5.65869430000000,5.70142600000000,5.74418740000000,5.78661900000000,5.82897850000000,5.87165980000000,5.91459230000000,5.95767100000000,6.00050260000000,6.04272100000000,6.08424850000000,6.12542960000000,6.16638330000000,6.20697930000000,6.24715900000000,6.28688700000000,6.32631970000000,6.36546400000000,6.40429070000000,6.44290400000000,6.48133850000000,6.51966330000000,6.55786230000000,6.59589770000000,6.63373400000000,6.67135000000000,6.70893700000000,6.74683670000000,6.78519300000000,6.82387070000000,6.86284350000000,6.90205400000000,6.94141100000000,6.98083200000000,7.02019200000000,7.05935430000000,7.09849000000000,7.13768240000000,7.17676160000000,7.21549370000000,7.25375200000000,7.29132840000000,7.32825370000000,7.36473000000000,7.40087400000000,7.43668460000000,7.47199100000000,7.50691750000000,7.54177950000000,7.57677840000000,7.61177970000000,7.64684200000000,7.68245100000000,7.71874500000000,7.75554800000000,7.79260500000000,7.82983880000000,7.86741640000000,7.90540930000000,7.94390400000000,7.98273850000000,8.02174100000000,8.06116000000000,8.10084100000000,8.14081100000000,8.18103200000000,8.22098350000000,8.26063700000000,8.29982000000000,8.33822300000000,8.37558000000000,8.41224600000000,8.44868000000000,8.48489700000000,8.52034950000000,8.55470100000000,8.58768200000000,8.61806900000000,8.64432800000000,8.66411600000000,8.67492700000000,8.67389500000000,8.65784800000000,8.62340300000000,8.56452000000000,8.46847300000000,8.34546500000000,8.21345500000000,8.08599800000000,7.97588630000000,7.89453200000000,7.84821200000000,7.82307050000000,7.80962230000000,0];
 tsurf2000 = [0,0,1.10209970000000,1.32837370000000,1.45727940000000,1.54384790000000,1.58784080000000,1.61412800000000,1.63411900000000,1.65414170000000,1.67687310000000,1.70227120000000,1.72951150000000,1.75889120000000,1.78930720000000,1.81932880000000,1.84967650000000,1.87998490000000,1.91019520000000,1.94168410000000,1.97585540000000,2.01261230000000,2.05187000000000,2.09318950000000,2.13579130000000,2.17898770000000,2.22169640000000,2.26334620000000,2.30379820000000,2.34288170000000,2.38024690000000,2.41613630000000,2.45100120000000,2.48483630000000,2.51755240000000,2.54892200000000,2.57918700000000,2.60926960000000,2.63959150000000,2.67020460000000,2.70122720000000,2.73312850000000,2.76633980000000,2.80080180000000,2.83641770000000,2.87291430000000,2.91010120000000,2.94771050000000,2.98581030000000,3.02459340000000,3.06408930000000,3.10448670000000,3.14543870000000,3.18631050000000,3.22692580000000,3.26702360000000,3.30602550000000,3.34362200000000,3.38016410000000,3.41584040000000,3.45057540000000,3.48475740000000,3.51869130000000,3.55207440000000,3.58479790000000,3.61736680000000,3.64978650000000,3.68153120000000,3.71326680000000,3.74579360000000,3.77904130000000,3.81271480000000,3.84663580000000,3.88103340000000,3.91590740000000,3.95118930000000,3.98696140000000,4.02293730000000,4.05875100000000,4.09395200000000,4.12812600000000,4.16137900000000,4.19370400000000,4.22544200000000,4.25674440000000,4.28759800000000,4.31775700000000,4.34766340000000,4.37754960000000,4.40742000000000,4.43727800000000,4.46675500000000,4.49567130000000,4.52429530000000,4.55323030000000,4.58259530000000,4.61233430000000,4.64267160000000,4.67371460000000,4.70523450000000,4.73731140000000,4.76989940000000,4.80253740000000,4.83492600000000,4.86740830000000,4.89994200000000,4.93213800000000,4.96394300000000,4.99573000000000,5.02760200000000,5.05950450000000,5.09126000000000,5.12254700000000,5.15348500000000,5.18457700000000,5.21577020000000,5.24664160000000,5.27712250000000,5.30750800000000,5.33771700000000,5.36735150000000,5.39654900000000,5.42534540000000,5.45406700000000,5.48324780000000,5.51272700000000,5.54200460000000,5.57105900000000,5.60000940000000,5.62898500000000,5.65822700000000,5.68776660000000,5.71736050000000,5.74668840000000,5.77584080000000,5.80516620000000,5.83504500000000,5.86564160000000,5.89682340000000,5.92868600000000,5.96106050000000,5.99373050000000,6.02640530000000,6.05880000000000,6.09070400000000,6.12192060000000,6.15264130000000,6.18320000000000,6.21379950000000,6.24441400000000,6.27510740000000,6.30609230000000,6.33728100000000,6.36841770000000,6.39939200000000,6.43024700000000,6.46109500000000,6.49182750000000,6.52240470000000,6.55295940000000,6.58353800000000,6.61383720000000,6.64382840000000,6.67383500000000,6.70383100000000,6.73365260000000,6.76348900000000,6.79360060000000,6.82418250000000,6.85558400000000,6.88816360000000,6.92175400000000,6.95607470000000,6.99165900000000,7.02903130000000,7.06795800000000,7.10804700000000,7.14897100000000,7.19096300000000,7.23401450000000,7.27768900000000,7.32144980000000,7.36473940000000,7.40776540000000,7.44957600000000,7.48913860000000,7.52623270000000,7.56010680000000,7.59038540000000,7.61680650000000,7.63909630000000,7.65701600000000,7.67017360000000,7.67883700000000,7.68633270000000,7.69575400000000,7.70925050000000,7.72709660000000,7.74815000000000,7.77088000000000,7.79119500000000,7.80827200000000,7.80962200000000,0];
 tsurf1000 = [0,0,0,1.29513110000000,1.50771160000000,1.64013100000000,1.73529110000000,1.78907050000000,1.82291100000000,1.84679830000000,1.86688830000000,1.88730180000000,1.90997000000000,1.93506930000000,1.96241000000000,1.99171770000000,2.02269120000000,2.05471600000000,2.08754470000000,2.12148280000000,2.15699300000000,2.19376090000000,2.23203180000000,2.27181770000000,2.31265020000000,2.35427020000000,2.39656600000000,2.43876120000000,2.48047780000000,2.52144530000000,2.56160380000000,2.60047390000000,2.63819720000000,2.67487600000000,2.71066330000000,2.74585460000000,2.78052950000000,2.81482960000000,2.84930320000000,2.88428700000000,2.91948960000000,2.95466730000000,2.98990700000000,3.02523040000000,3.06060620000000,3.09600970000000,3.13128760000000,3.16638400000000,3.20139550000000,3.23679350000000,3.27289270000000,3.30939530000000,3.34645080000000,3.38448480000000,3.42380070000000,3.46367600000000,3.50289920000000,3.54162480000000,3.58046340000000,3.61963030000000,3.65920700000000,3.69919820000000,3.73922970000000,3.77846960000000,3.81680750000000,3.85455820000000,3.89193580000000,3.92901370000000,3.96549490000000,4.00112630000000,4.03555630000000,4.06927630000000,4.10274800000000,4.13581230000000,4.16851660000000,4.20104100000000,4.23358960000000,4.26611100000000,4.29884100000000,4.33169650000000,4.36455440000000,4.39753600000000,4.43068360000000,4.46363400000000,4.49591160000000,4.52724740000000,4.55782130000000,4.58772300000000,4.61685600000000,4.64492230000000,4.67214870000000,4.69916530000000,4.72644400000000,4.75399100000000,4.78178200000000,4.81022400000000,4.83974460000000,4.87047340000000,4.90206400000000,4.93436700000000,4.96735300000000,5.00107200000000,5.03564200000000,5.07089200000000,5.10675240000000,5.14323700000000,5.18024440000000,5.21761750000000,5.25483040000000,5.29149630000000,5.32724400000000,5.36189170000000,5.39546060000000,5.42825030000000,5.46059750000000,5.49236500000000,5.52353700000000,5.55424700000000,5.58427430000000,5.61350870000000,5.64207940000000,5.66978600000000,5.69674440000000,5.72342060000000,5.74964800000000,5.77510550000000,5.79995800000000,5.82446580000000,5.84857940000000,5.87266640000000,5.89706600000000,5.92169700000000,5.94672900000000,5.97237160000000,5.99855900000000,6.02551900000000,6.05368140000000,6.08281400000000,6.11259650000000,6.14293900000000,6.17390970000000,6.20549500000000,6.23747400000000,6.27000050000000,6.30323400000000,6.33712630000000,6.37176600000000,6.40701530000000,6.44247200000000,6.47766730000000,6.51237770000000,6.54674050000000,6.58077860000000,6.61398700000000,6.64644700000000,6.67835700000000,6.70940260000000,6.73967650000000,6.76918900000000,6.79793260000000,6.82639700000000,6.85472000000000,6.88243100000000,6.90964600000000,6.93704840000000,6.96517320000000,6.99389000000000,7.02275560000000,7.05190200000000,7.08124000000000,7.11057900000000,7.13993550000000,7.16937400000000,7.19894100000000,7.22881100000000,7.25898360000000,7.28938960000000,7.31997060000000,7.35100030000000,7.38239770000000,7.41412260000000,7.44609740000000,7.47837920000000,7.51110200000000,7.54344270000000,7.57439800000000,7.60324340000000,7.62939740000000,7.65208150000000,7.67072700000000,7.68500000000000,7.69493960000000,7.70042700000000,7.70203700000000,7.70211650000000,7.70467230000000,7.71242050000000,7.72595200000000,7.74365600000000,7.76297000000000,7.78179700000000,7.79696040000000,7.80845000000000,0];
 
 for i = 1:nx
     trelaxflat(i,:) = tsurfflat - surfQ(1,:)/10/10^3/4000*2.592e+06;
     trelax250(i,:) = tsurf250 -  surfQ(1,:)/10/10^3/4000*2.592e+06;
     trelax500(i,:) = tsurf500 - surfQ(1,:)/10/10^3/4000*2.592e+06;
     trelax1000(i,:) = tsurf1000 - surfQ(1,:)/10/10^3/4000*2.592e+06;
     trelax2000(i,:) = tsurf2000 - surfQ(1,:)/10/10^3/4000*2.592e+06;
     trelax2000x2(i,:) = tsurf2000x2 - surfQ(1,:)/10/10^3/4000*2.592e+06;
 end

trelaxflat(:,end-1:end) = 8;
trelax250(:,end-1:end) = 8;
trelax500(:,end-1:end) = 8;
trelax1000(:,end-1:end) = 8;
trelax2000(:,end-1:end) = 8;
trelax2000x2(:,end-1:end) = 8;

 

 
 fid = fopen('trelaxflat.bin','w','b');
fwrite(fid,trelaxflat,'real*8'); fclose(fid);

 fid = fopen('trelax250.bin','w','b');
fwrite(fid,trelax250,'real*8'); fclose(fid);

 fid = fopen('trelax500.bin','w','b');
fwrite(fid,trelax500,'real*8'); fclose(fid);

 fid = fopen('trelax1000.bin','w','b');
fwrite(fid,trelax1000,'real*8'); fclose(fid);

 fid = fopen('trelax2000.bin','w','b');
fwrite(fid,trelax2000,'real*8'); fclose(fid);

 fid = fopen('trelax2000x2.bin','w','b');
fwrite(fid,trelax2000x2,'real*8'); fclose(fid);
 



%% make figure of boundary conditions
h1 = figure(34);
hold on
h11 = subplot(1,3,1);
plot(squeeze(spongetemp(1,1,:)),zc,'k')
xlim([0 8])
xlabel('Northern Boundary Temperature (^\circ C)')
ylabel('Depth (m)')
text(0.4,-100,'(a)','fontsize',16)

h21 = subplot(1,3,2);
box on
plot(-surfQ(1,3:202),10:10:2000,'k')
ylabel('Y (km)')
xlabel('Heat Flux (W m^{-2})')
text(-9,1950,'(b)','fontsize',16)

h31 = subplot(1,3,3);
hold on; box on
plot(tsurf2000(3:202),10:10:2000,'-k')
plot(trelax2000(1,3:202),10:10:2000,'--k')
xlim([0 8])
legend('Surface Temperature','Relaxation Temperature')
ylabel('Y (km)')
xlabel('Surface Temperature (^\circ C)')

text(0.5,1950,'(c)','fontsize',16)

set(h1,'position',[100 100 1000 450])
set(h11,'position',[0.075 0.12 0.26 0.85])
set(h21,'position',[0.397 0.12 0.26 0.85])
set(h31,'position',[0.72 0.12 0.26 0.85])

SaveFigureThesis(h1,'BoundaryConditions')

%% 
cd ~/Documents/Work/Thesis
theta = rdmds('DIAGInstant',NaN);
theta(theta==0) = NaN;



hand = figure;

[nx,nyp,nz] = size(theta);

yp = 0:10:1990;
x = 0:10:3990;
 %%% Make the plot
     co = brewermap([],'BuPu');

 %%% Make the plot
        clf; hold on
        eta_plot = 0*ones(ny-40,nx);
        %box on
        Ro = theta(:,43:end-2,1)';
        p = surface(x,yp(41:end),eta_plot,log(Ro));
        plot3(wind(1,3:end-2)*8000+1500,yp,400*ones(ny,1),'k','linewidth',3)
        plot3(0*ones(ny,1)+1500,yp,400*ones(ny,1),'k','linewidth',3)
        annotation('arrow',[0.47 0.55],[0.69 0.71],'linewidth',3,'headwidth',15) 
        annotation('arrow',[0.41 0.46],[0.73 0.74],'linewidth',3,'headwidth',15) 
        annotation('arrow',[0.54 0.59],[0.64 0.655],'linewidth',3,'headwidth',15) 
        annotation('textbox',[0.16 0.75 0.1 0.1],'string','Wind \tau',...
            'FitBoxToText','on','fontsize',18) 
        p.FaceColor = 'texturemap';
        %set(ax,'ColorScale','log')
        colormap(co);
        caxis([-0.4 log(9)]);
%       colorbar
%         caxis([-1 1]);
%         p.FaceColor = [110 193 248]/256;
        p.EdgeColor = 'none';         
        alpha 1;
        hold on;
        
        

         %eta_plot = (-H1 - hint)*1000;
%         eta_plot(1,:) = -670;
%         eta_plot(:,1) = -670;
          %Ro = ones(nyp,nx);
          etaplot = zgrid(43:end-2,:);
          Ro = squeeze(theta(1,43:end-2,:));
          p = surface(0*ones(32,1),yp(41:end),etaplot,log(Ro));     
          p.FaceColor = 'texturemap';
          p.EdgeColor = 'none';   
          caxis([-0.4 log(9)]);
          
          etaplot = zgrid(1,:)'*ones(400,1)';
          Ro = squeeze(theta(:,41,:));
          p = surface(x,yp(41)*ones(32,1),etaplot,real(log(Ro')));     
          p.FaceColor = 'texturemap';
          p.EdgeColor = 'none';  
          caxis([-0.4 log(9)]);
          TickLabels = [1,3,5,7];
          Ticks = log([1,3,5,7]);
          %c1 = colorbar('Ticks',Ticks,'TickLabels',TickLabels,'location','eastoutside');
          %ylabel(c1,'Temperature (^\circ C)')
          %get(c1,position)
          %set(c1,'position',[0.9176    0.1100    0.0200    0.8150])
            
          
          %cont = contourc(zgrid(1,:),x,Ro,[1.1 1.1]);
          %plot3(cont(2,2:end-5),0*ones(length(cont)-6),cont(1,2:end-5),'k','linewidth',2)

          
          
          
          %p.FaceColor = [48 129 238]/400;
  
          %alpha(p,1);
         p = surface(x,yp-1,bathy2000(:,3:end-2)');
          p.FaceColor = [139,69,19]/150;
         %p.EdgeColor = 'none';          
         %%hold off;        
% %         axis([0 Lx 0 Ly -1500 0])
% %         caxis([-1500 0]);
% %         colorbar;
%         view(110,30);
         view(-30,25);
%         view(0,90);
        lighting none;
        camlight('headlight'); 
        %camlight('left')
        %title(strcat(['t=',num2str(t/t1year,'%.2f'),' years']));        
        xlabel('X (km)');
        ylabel('Y (km)');
        zlabel('Depth (m)');
        set(gca,'FontSize',16,'ztick',-4000:1000:0);
        set(gcf,'Color','w');
        
        set(hand,'position',[100 100 700 450])
%%
 
 load 3dres
 

wres = permute(wres_z,[2 3 1]);
vres = permute(vres_z,[2 3 1]);
vres(isnan(vres)) = 0;
ures = permute(ures_z,[2 3 1]);
ures(isnan(ures)) = 0;

[xgrid, ygrid, zgrid] = meshgrid(x(1:end)*1000,yp(1:end)*1000,Z(1:end));
[sx, sy, sz] = meshgrid(x(1:20:end)*1000,yp(1:20:end)*1000,Z(1:end));
 
h1 = figure(23);

streamline(xgrid,ygrid,zgrid,ures(3:202,:,:),vres(3:202,:,:),wres(3:202,:,:),sx,sy,sz)
view(3);
xyz = stream3(xgrid,ygrid,zgrid,ures(3:202,:,:),vres(3:202,:,:),0*wres(3:202,:,:),sx(:,2,10),sy(:,2,10),sz(:,2,10),[0.01 1e20]);


%quiver3(xgrid(3:20:202,1:20:end,6:2:end),ygrid(3:20:202,1:20:end,6:2:end),zgrid(3:20:202,1:20:end,6:2:end),ures(3:20:202,1:20:end,6:2:end),vres(3:20:202,1:20:end,6:2:end),wres(3:20:202,1:20:end,6:2:end))

streamline(xgrid(:,:,10),ygrid(:,:,10),ures(3:202,:,10),vres(3:202,:,10),sx(:,2,1),sy(:,2,1));

%streamline(squeeze(xgrid(100,1:5:end,12:end)),squeeze(zgrid(100,1:5:end,12:end)),squeeze(ures(100,1:5:end,12:end)),squeeze(wres(100,1:5:end,12:end)))